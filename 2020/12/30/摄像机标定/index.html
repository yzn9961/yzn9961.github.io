<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"github.com","root":"/","images":"/images","scheme":"Gemini","version":"8.1.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}};
  </script>
<meta name="description" content="相机标定学习笔记[TOC] 一、相机标定理论概述1.1 什么是相机标定获取相机参数的过程称之为计算机标定。相机参数分为内参与外参：  相机内参：即镜头本身的参数，包含焦距、缩放比例(像素在世界坐标系中的尺寸)、镜头畸变参数等。 相机外参：即外部参数矩阵，是联系摄像机坐标系与世界坐标系之间的桥梁，将摄像机坐标系中的点的位置坐标转化为世界坐标系中点的坐标。外部参数矩阵中包含了镜头的在三维空间中的位置信">
<meta property="og:type" content="article">
<meta property="og:title" content="双目摄像机标定(一)">
<meta property="og:url" content="https://github.com/yzn9961/yzn9961.github.io/2020/12/30/%E6%91%84%E5%83%8F%E6%9C%BA%E6%A0%87%E5%AE%9A/index.html">
<meta property="og:site_name" content="济川的个人博客">
<meta property="og:description" content="相机标定学习笔记[TOC] 一、相机标定理论概述1.1 什么是相机标定获取相机参数的过程称之为计算机标定。相机参数分为内参与外参：  相机内参：即镜头本身的参数，包含焦距、缩放比例(像素在世界坐标系中的尺寸)、镜头畸变参数等。 相机外参：即外部参数矩阵，是联系摄像机坐标系与世界坐标系之间的桥梁，将摄像机坐标系中的点的位置坐标转化为世界坐标系中点的坐标。外部参数矩阵中包含了镜头的在三维空间中的位置信">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.learnopencv.com/wp-content/uploads/2020/02/camera-projection-3D-to-2D.png">
<meta property="og:image" content="https://www.learnopencv.com/wp-content/uploads/2019/11/geometric-calibration-1024x381.jpg">
<meta property="og:image" content="https://www.learnopencv.com/wp-content/uploads/2020/02/camera-calibration-flowchart-1024x910.png">
<meta property="og:image" content="https://blogpicbed.oss-cn-beijing.aliyuncs.com/img/pattern.jpg">
<meta property="og:image" content="https://www.learnopencv.com/wp-content/uploads/2019/11/checkerboard-pattern-detection2.jpg">
<meta property="og:image" content="https://blogpicbed.oss-cn-beijing.aliyuncs.com/img/R_1.jpg">
<meta property="og:image" content="https://blogpicbed.oss-cn-beijing.aliyuncs.com/img/image-20201223232837530.png">
<meta property="og:image" content="https://blogpicbed.oss-cn-beijing.aliyuncs.com/img/black_edge.jpg">
<meta property="og:image" content="https://www.learnopencv.com/wp-content/uploads/2020/02/image_2.jpg">
<meta property="og:image" content="https://blogpicbed.oss-cn-beijing.aliyuncs.com/img/FotoJet.jpg">
<meta property="og:image" content="https://blogpicbed.oss-cn-beijing.aliyuncs.com/img/image-20201223213014521.png">
<meta property="og:image" content="https://blogpicbed.oss-cn-beijing.aliyuncs.com/img/image-20201223230933744.png">
<meta property="og:image" content="https://blogpicbed.oss-cn-beijing.aliyuncs.com/img/image-20201223144024650.png">
<meta property="og:image" content="c:/Users/杨济宁/Pictures/1.jpg">
<meta property="og:image" content="c:/Users/杨济宁/Pictures/with_edge.jpg">
<meta property="og:image" content="c:/Users/杨济宁/Pictures/no_edge.jpg">
<meta property="article:published_time" content="2020-12-30T14:28:57.825Z">
<meta property="article:modified_time" content="2020-12-30T14:29:44.272Z">
<meta property="article:author" content="杨济宁">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.learnopencv.com/wp-content/uploads/2020/02/camera-projection-3D-to-2D.png">


<link rel="canonical" href="https://github.com/yzn9961/yzn9961.github.io/2020/12/30/%E6%91%84%E5%83%8F%E6%9C%BA%E6%A0%87%E5%AE%9A/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>
<title>双目摄像机标定(一) | 济川的个人博客</title>
  




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">济川的个人博客</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">明德精学，笃行致强。</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%9B%B8%E6%9C%BA%E6%A0%87%E5%AE%9A%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0"><span class="nav-text">相机标定学习笔记</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E7%9B%B8%E6%9C%BA%E6%A0%87%E5%AE%9A%E7%90%86%E8%AE%BA%E6%A6%82%E8%BF%B0"><span class="nav-text">一、相机标定理论概述</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E4%BB%80%E4%B9%88%E6%98%AF%E7%9B%B8%E6%9C%BA%E6%A0%87%E5%AE%9A"><span class="nav-text">1.1 什么是相机标定</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E7%9B%B8%E6%9C%BA%E6%A0%87%E5%AE%9A%E7%9A%84%E6%84%8F%E4%B9%89"><span class="nav-text">1.2 相机标定的意义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-%E7%9B%B8%E6%9C%BA%E6%A0%87%E5%AE%9A%E5%8E%9F%E7%90%86"><span class="nav-text">1.3 相机标定原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-%E7%9B%B8%E6%9C%BA%E6%A0%87%E5%AE%9A%E6%B5%81%E7%A8%8B"><span class="nav-text">1.4 相机标定流程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E7%9B%B8%E6%9C%BA%E6%A0%87%E5%AE%9A%E5%AE%9E%E8%B7%B5%EF%BC%9A%E8%8E%B7%E5%8F%96%E5%8F%8C%E7%9B%AE%E6%91%84%E5%83%8F%E5%A4%B4%E4%B8%A4%E4%B8%AA%E9%95%9C%E5%A4%B4%E7%9A%84%E5%86%85%E5%A4%96%E5%8F%82"><span class="nav-text">二、相机标定实践：获取双目摄像头两个镜头的内外参</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E6%A0%87%E5%AE%9A%E6%95%B0%E6%8D%AE%E9%9B%86%E7%9A%84%E5%BB%BA%E7%AB%8B"><span class="nav-text">2.1 标定数据集的建立</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-1-%E6%A3%8B%E7%9B%98%E6%A0%BC%E6%A0%87%E5%AE%9A%E6%9D%BF"><span class="nav-text">2.1.1 棋盘格标定板</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-2-%E4%BB%8E%E5%A4%9A%E4%B8%AA%E8%A7%92%E5%BA%A6%E6%8B%8D%E6%91%84%E6%A0%87%E5%AE%9A%E6%9D%BF%E5%9B%BE%E5%83%8F"><span class="nav-text">2.1.2 从多个角度拍摄标定板图像</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-3-%E7%A1%AE%E5%AE%9A%E5%85%B3%E9%94%AE%E7%82%B9%E5%9C%A8%E7%9C%9F%E5%AE%9E%E4%B8%96%E7%95%8C%E4%B8%AD%E7%9A%84%E4%B8%89%E7%BB%B4%E5%9D%90%E6%A0%87"><span class="nav-text">2.1.3 确定关键点在真实世界中的三维坐标</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E7%A1%AE%E5%AE%9A%E5%85%B3%E9%94%AE%E7%82%B9%E5%9C%A8%E5%9B%BE%E5%83%8F%E5%B9%B3%E9%9D%A2%E4%B8%8A%E7%9A%84%E4%BD%8D%E7%BD%AE"><span class="nav-text">2.2 确定关键点在图像平面上的位置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-1-%E5%9C%A8%E5%9B%BE%E5%83%8F%E4%B8%8A%E5%AE%9A%E4%BD%8D%E5%85%B3%E9%94%AE%E7%82%B9%E7%9A%84%E5%83%8F%E7%B4%A0%E4%BD%8D%E7%BD%AE"><span class="nav-text">2.2.1 在图像上定位关键点的像素位置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-%E4%BD%BF%E7%94%A8%E4%BA%9A%E5%83%8F%E7%B4%A0%E7%B2%BE%E5%87%86%E5%8C%96%E5%85%B3%E9%94%AE%E7%82%B9%E5%9D%90%E6%A0%87%E4%BD%8D%E7%BD%AE"><span class="nav-text">2.2.2 使用亚像素精准化关键点坐标位置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-3-%E5%8F%AF%E9%80%89-%E5%9C%A8%E5%9B%BE%E5%83%8F%E4%B8%8A%E7%BB%98%E5%88%B6%E5%85%B3%E9%94%AE%E7%82%B9"><span class="nav-text">2.2.3 (可选)在图像上绘制关键点</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E6%A0%87%E5%AE%9A%E6%91%84%E5%83%8F%E5%A4%B4%E5%86%85%E5%A4%96%E5%8F%82"><span class="nav-text">2.3 标定摄像头内外参</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-%E7%95%B8%E5%8F%98%E7%9F%AB%E6%AD%A3"><span class="nav-text">2.4 畸变矫正</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-1-%E4%BD%BF%E7%94%A8initUndistortRectifyMap-remap-%E5%AE%9E%E7%8E%B0"><span class="nav-text">2.4.1  使用initUndistortRectifyMap()+remap()实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-2-%E4%BD%BF%E7%94%A8cv-undistort-%E5%AE%9E%E7%8E%B0"><span class="nav-text">2.4.2  使用cv::undistort()实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-3-%E7%95%B8%E5%8F%98%E7%9F%AB%E6%AD%A3%E6%95%88%E6%9E%9C%E5%B1%95%E7%A4%BA"><span class="nav-text">2.4.3 畸变矫正效果展示</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E7%A8%8B%E5%BA%8F%E4%BB%A3%E7%A0%81"><span class="nav-text">三、程序代码</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%BE%E5%83%8F%E9%87%87%E9%9B%86%E4%BB%A3%E7%A0%81"><span class="nav-text">图像采集代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%B8%E6%9C%BA%E6%A0%87%E5%AE%9A%E4%BB%A3%E7%A0%81"><span class="nav-text">相机标定代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%95%B8%E5%8F%98%E7%9F%AB%E6%AD%A3%E4%BB%A3%E7%A0%81"><span class="nav-text">畸变矫正代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-text">四、参考资料</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="杨济宁"
      src="https://i.loli.net/2020/12/30/8bF7syp2rSPZwcK.jpg">
  <p class="site-author-name" itemprop="name">杨济宁</p>
  <div class="site-description" itemprop="description">兴趣：计算机视觉，机器学习，深度学习</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">2</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://github.com/yzn9961/yzn9961.github.io/2020/12/30/%E6%91%84%E5%83%8F%E6%9C%BA%E6%A0%87%E5%AE%9A/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://i.loli.net/2020/12/30/8bF7syp2rSPZwcK.jpg">
      <meta itemprop="name" content="杨济宁">
      <meta itemprop="description" content="兴趣：计算机视觉，机器学习，深度学习">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="济川的个人博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          双目摄像机标定(一)
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-12-30 22:28:57 / 修改时间：22:29:44" itemprop="dateCreated datePublished" datetime="2020-12-30T22:28:57+08:00">2020-12-30</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="相机标定学习笔记"><a href="#相机标定学习笔记" class="headerlink" title="相机标定学习笔记"></a>相机标定学习笔记</h1><p>[TOC]</p>
<h2 id="一、相机标定理论概述"><a href="#一、相机标定理论概述" class="headerlink" title="一、相机标定理论概述"></a>一、相机标定理论概述</h2><h3 id="1-1-什么是相机标定"><a href="#1-1-什么是相机标定" class="headerlink" title="1.1 什么是相机标定"></a>1.1 什么是相机标定</h3><p>获取相机参数的过程称之为计算机标定。相机参数分为内参与外参：</p>
<ul>
<li><strong>相机内参</strong>：即镜头本身的参数，包含焦距、缩放比例(像素在世界坐标系中的尺寸)、镜头畸变参数等。</li>
<li><strong>相机外参</strong>：即外部参数矩阵，是联系摄像机坐标系与世界坐标系之间的桥梁，将摄像机坐标系中的点的位置坐标转化为世界坐标系中点的坐标。外部参数矩阵中包含了镜头的在三维空间中的位置信息以及角度信息(水平偏转、垂直俯仰、法平面旋转)。世界/相机坐标系定义<a target="_blank" rel="noopener" href="https://www.learnopencv.com/geometry-of-image-formation/">参考</a>。</li>
<li><strong>内参、外参、世界坐标系、相机坐标系之间的联系</strong>：位于<strong>世界坐标系</strong>中的目标坐标通过相机<strong>外参矩阵</strong>转换到<strong>相机坐标系</strong>中，再通过<strong>内参矩阵</strong>投射到<strong>图像平面</strong>上。</li>
</ul>
<p>通过获取相机的内外参，<strong>我们可以将目标在世界坐标系中的三维坐标信息转换为图像平面上的像素位置</strong>。换言之，获取了相机的内外参数我们就可以模拟出一个相机的数学模型。</p>
<p><img src="https://www.learnopencv.com/wp-content/uploads/2020/02/camera-projection-3D-to-2D.png" alt="Camera Projection from 3D to 2D"></p>
<h3 id="1-2-相机标定的意义"><a href="#1-2-相机标定的意义" class="headerlink" title="1.2 相机标定的意义"></a>1.2 相机标定的意义</h3><p>通过获取摄像机的参数来对图像进行矫正，从而减小图像上的畸变。</p>
<p><img src="https://www.learnopencv.com/wp-content/uploads/2019/11/geometric-calibration-1024x381.jpg" alt="Correction after geometric calibration"></p>
<h3 id="1-3-相机标定原理"><a href="#1-3-相机标定原理" class="headerlink" title="1.3 相机标定原理"></a>1.3 相机标定原理</h3><p>如上文所述，借由相机的内外参，我们可以完成目标点在现实世界中的三维坐标与在图像平面上的像素位置的相互转换。相机标定的原理与上述过程相反：<strong>我们已知一组点集在现实中的三维坐标，以及它们在图像平面上的像素位置，通过数学方法求出两组坐标系之间的转换关系——即相机的内外参数</strong>。</p>
<ul>
<li><strong>相机标定的输入</strong>：多张包含关键点的图像。对于该组图像上的关键点，我们知道它们位于现实世界的实际坐标以及其投射在图像平面上的像素位置。</li>
<li><strong>相机标定的输出</strong>：相机的内外参数矩阵。</li>
</ul>
<h3 id="1-4-相机标定流程"><a href="#1-4-相机标定流程" class="headerlink" title="1.4 相机标定流程"></a>1.4 相机标定流程</h3><p>相机标定大致按照以下几个流程进行：</p>
<ul>
<li><strong>建立标定数据集：</strong>我们需要收集一组图像，每张图像中包含一组已知其在真实世界中三维坐标的关键点。</li>
<li><strong>在图像上定位关键点：</strong>查找出关键点在图像平面上对应的像素位置信息。</li>
<li><strong>标定相机内外参：</strong>通过opencv的相机标定函数，计算出相机的内外参数。</li>
<li><strong>畸变矫正：</strong>通过相机参数矫正图像上的畸变。</li>
</ul>
<img src="https://www.learnopencv.com/wp-content/uploads/2020/02/camera-calibration-flowchart-1024x910.png" alt="Camera Calibration Flowchart" style="zoom: 45%;" /> 

<h2 id="二、相机标定实践：获取双目摄像头两个镜头的内外参"><a href="#二、相机标定实践：获取双目摄像头两个镜头的内外参" class="headerlink" title="二、相机标定实践：获取双目摄像头两个镜头的内外参"></a>二、相机标定实践：获取双目摄像头两个镜头的内外参</h2><p>我们按照上述流程来对下图所示型号双目摄像头进行标定。我们在基于opencv3.4.2的环境下使用c++进行实现。 </p>
<img src="https://blogpicbed.oss-cn-beijing.aliyuncs.com/img/pattern.jpg" alt="image-20201223144024650" style="zoom: 15%;" />

<h3 id="2-1-标定数据集的建立"><a href="#2-1-标定数据集的建立" class="headerlink" title="2.1 标定数据集的建立"></a>2.1 标定数据集的建立</h3><h4 id="2-1-1-棋盘格标定板"><a href="#2-1-1-棋盘格标定板" class="headerlink" title="2.1.1 棋盘格标定板"></a>2.1.1 棋盘格标定板</h4><p>进行相机标定时一般采用张正友标定法来对关键点进行选择。张正友标定法采用一张黑白相间的棋盘格图像作为相机标定的标定板，在进行标定时，该方法会提取棋盘格标定板的内角点集作为关键点集，如下图所示：</p>
<img src="https://www.learnopencv.com/wp-content/uploads/2019/11/checkerboard-pattern-detection2.jpg" alt="Result after drawing the detected checker board corners" style="zoom: 67%;" />

<p>在本次标定中，我们使用的标定板图像如下图所示。我们可以观察到，该标定板图像纵向有6个内角点作为标定关键点，横向有9个内角点作为标定关键点。</p>
<img src="https://blogpicbed.oss-cn-beijing.aliyuncs.com/img/R_1.jpg" alt="pattern" style="zoom: 33%;" />

<h4 id="2-1-2-从多个角度拍摄标定板图像"><a href="#2-1-2-从多个角度拍摄标定板图像" class="headerlink" title="2.1.2 从多个角度拍摄标定板图像"></a>2.1.2 从多个角度拍摄标定板图像</h4><p>为了计算出相机的内外参数我们需要多组包含关键点信息的数据集，故我们需要从多个角度对标定板进行拍摄，获取多个角度的标定板图像。下图是从多个角度拍摄的标定板数据集。数据集中的照片数量越多，计算越精确但同时计算开销也越大。这里我使用双目摄像头从不同角度拍摄了39张照片作为标定数据集。</p>
<p><img src="https://blogpicbed.oss-cn-beijing.aliyuncs.com/img/image-20201223232837530.png" alt="image-20201223213014521"></p>
<p>使用双目摄像头进行拍照，并将左右摄像头拍摄的图像分别存储程序的部分代码如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">VideoCapture <span class="title">cap</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">	<span class="keyword">if</span> (!cap.isOpened())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;摄像头读取错误!&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//设置捕获视频尺寸</span></span><br><span class="line">	<span class="keyword">char</span> filename[<span class="number">200</span>];</span><br><span class="line">	cap.<span class="built_in">set</span>(CAP_PROP_FRAME_WIDTH, <span class="number">2560</span>); </span><br><span class="line">	cap.<span class="built_in">set</span>(CAP_PROP_FRAME_HEIGHT,<span class="number">720</span>);</span><br><span class="line">	<span class="keyword">int</span> i =<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">string</span> name;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;拍照模式：按空格键进行拍摄。q 或 Esc 退出。&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="built_in">string</span> window_name = <span class="string">&quot;拍照模式：按空格键进行拍摄 | q 或 Esc 退出&quot;</span>;</span><br><span class="line">	namedWindow(window_name,WINDOW_NORMAL); <span class="comment">//not resizable window;</span></span><br><span class="line">	Mat frameTotal;</span><br><span class="line">	<span class="comment">//Rect Total(0, 150, 640, 180);//全画幅</span></span><br><span class="line">	<span class="function">Rect <span class="title">Lrect</span><span class="params">(<span class="number">0</span>,<span class="number">0</span>, <span class="number">2560</span>/<span class="number">2</span>,<span class="number">720</span>)</span></span>;<span class="comment">//左ROI</span></span><br><span class="line">	<span class="function">Rect <span class="title">Rrect</span><span class="params">(<span class="number">2560</span> / <span class="number">2</span>, <span class="number">0</span>, <span class="number">2560</span>/<span class="number">2</span>, <span class="number">720</span>)</span></span>; <span class="comment">//右ROI</span></span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		cap &gt;&gt; frameTotal;</span><br><span class="line">		imshow(<span class="string">&quot;拍照模式：按空格键进行拍摄 | q 或 Esc 退出&quot;</span>, frameTotal);</span><br><span class="line">		<span class="keyword">char</span> key = (<span class="keyword">char</span>)waitKey(<span class="number">30</span>);</span><br><span class="line">		<span class="keyword">switch</span> (key)</span><br><span class="line">		&#123;</span><br><span class="line">		<span class="keyword">case</span><span class="number">&#x27;</span>q<span class="number">&#x27;</span>:</span><br><span class="line">		<span class="keyword">case</span><span class="number">&#x27;</span>Q<span class="number">&#x27;</span>:</span><br><span class="line">		<span class="keyword">case</span> <span class="number">27</span>:</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&#x27; &#x27;</span>:</span><br><span class="line">			sprintf_s(filename, <span class="string">&quot;Capture_%d.jpg&quot;</span>, i);</span><br><span class="line">			imwrite(filename, frameTotal);<span class="comment">//保存全画幅</span></span><br><span class="line">			sprintf_s(filename, <span class="string">&quot;L_%d.jpg&quot;</span>, i);</span><br><span class="line">			imwrite(filename, frameTotal(Lrect));<span class="comment">//保存左画幅</span></span><br><span class="line">			sprintf_s(filename, <span class="string">&quot;R_%d.jpg&quot;</span>, i);</span><br><span class="line">			imwrite(filename, frameTotal(Rrect));<span class="comment">//保存右画幅</span></span><br><span class="line">			<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;捕捉到第&quot;</span>&lt;&lt;i&lt;&lt;<span class="string">&quot;组图像&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">			i++;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>需要注意的是，<strong>在制作标定板的过程中一定要在标定板周围留出足够宽(越宽越好)的白边</strong>，否则opencv将无法检测出标定板上的关键点，从而标定失败。这是因为当棋盘格标定板外侧无白边或是拍摄背景为黑色时，下文将会用到的关键点定位函数<code>findChessboardCorners() </code>内部的分组与排序算法将会失效。所以<strong>标定板周围需要留出足够宽的白边，同时不要在黑暗的背景环境下拍摄</strong>。下图是我使用ipad作为标定板拍摄的标定照片，可以看出标定图像并没有占据整个屏幕，而是留出了一定空余的白边。</p>
<img src="https://blogpicbed.oss-cn-beijing.aliyuncs.com/img/black_edge.jpg" alt="R_1" style="zoom:35%;" />

<h4 id="2-1-3-确定关键点在真实世界中的三维坐标"><a href="#2-1-3-确定关键点在真实世界中的三维坐标" class="headerlink" title="2.1.3 确定关键点在真实世界中的三维坐标"></a>2.1.3 确定关键点在真实世界中的三维坐标</h4><p>由理论部分我们已经知道，标定出相机的内外参数需要同时确定出关键点<strong>在真实世界的三维坐标</strong>以及<strong>在图像平面上的像素位置</strong>。在这一步我们对第一个问题进行解决。关键点在真实世界的三维坐标<strong>是人为规定的</strong>。观察下图所示的棋盘格标定板，我们规定墙面为三维坐标系中的x-y平面，指向地面方向为x轴，水平向右方向为y轴，而z轴则位于垂直于墙面的方向。显然，为了简化操作，我们将所有关键点的z轴坐标都设置为0，即将所有关键点都放置于x-y平面上。</p>
<img src="https://www.learnopencv.com/wp-content/uploads/2020/02/image_2.jpg" alt="Checkerboard pattern " style="zoom: 60%;" />

<p>使用棋盘格标定板进行标定的一个优点在于所有关键点之间的水平/竖直间隔均一致，故在我们人为规定一个关键点的三维坐标信息后，可以简便的迭代计算出其余关键点在真实世界中的三维坐标信息。6*9内角点标定板的关键点坐标信息输入程序如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> CHESSBOARD[<span class="number">2</span>] = &#123; <span class="number">6</span>,<span class="number">9</span> &#125;;</span><br><span class="line"><span class="built_in">vector</span>&lt;Point3f&gt;objp;<span class="comment">//存储关键点的真实三维坐标信息</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; CHESSBOARD[<span class="number">1</span>]; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; CHESSBOARD[<span class="number">0</span>]; j++)</span><br><span class="line">			objp.push_back(Point3f(i, j, <span class="number">0</span>));<span class="comment">//逐行标记内角点坐标</span></span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-2-确定关键点在图像平面上的位置"><a href="#2-2-确定关键点在图像平面上的位置" class="headerlink" title="2.2 确定关键点在图像平面上的位置"></a>2.2 确定关键点在图像平面上的位置</h3><p>通过第一步的操作我们获得了一组从多角度拍摄的标定板图像作为我们的标定数据集，同时对于数据集中的关键点集我们人为的规定了其在真实世界的三维坐标信息，我们最后需要确定的是这些关键点在各个图片上的二维像素坐标。</p>
<h4 id="2-2-1-在图像上定位关键点的像素位置"><a href="#2-2-1-在图像上定位关键点的像素位置" class="headerlink" title="2.2.1 在图像上定位关键点的像素位置"></a>2.2.1 在图像上定位关键点的像素位置</h4><p>在图像上定位关键点我们直接使用opencv内置的函数实现<code>findChessboardCorners()</code>，该函数原型如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cv::findChessboardCorners</span>	<span class="params">(InputArray image,</span></span></span><br><span class="line"><span class="function"><span class="params">								Size 	patternSize,</span></span></span><br><span class="line"><span class="function"><span class="params">								OutputArray 	corners,</span></span></span><br><span class="line"><span class="function"><span class="params">								<span class="keyword">int</span> 	flags </span></span></span><br><span class="line"><span class="function"><span class="params">								)</span>	</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>InputArray image：</strong>输入图像</li>
<li><strong>Size     patternSize：</strong>标定板尺寸，我使用的标定板尺寸是6*9格式</li>
<li><strong>OutputArray：</strong>检测到的关键点坐标集合，类型为<code>vector&lt;Point2f&gt;</code></li>
<li><strong>int     flags:</strong> 算法的其他参数，一般选择默认值<code>CALIB_CB_ADAPTIVE_THRESH + CALIB_CB_NORMALIZE_IMAGE + CALIB_CB_FAST_CHECK</code>即可。</li>
</ul>
<p>该算法会在每张图片上检索以<code>patternSize</code>格式(对于我的标定板该值是6 * 9)排布的关键点集，若无法完整的检测出一组以 6 * 9格式排布的关键点集，则函数返回布尔值为0，反之若完整的检测出标定板上的关键点集合，则返回一个非零布尔值。</p>
<h4 id="2-2-2-使用亚像素精准化关键点坐标位置"><a href="#2-2-2-使用亚像素精准化关键点坐标位置" class="headerlink" title="2.2.2 使用亚像素精准化关键点坐标位置"></a>2.2.2 使用亚像素精准化关键点坐标位置</h4><p>由于相机标定对于数据精准度的要求很高，为了进一步提升我们标定结果的精准度，我们需要在<strong>亚像素</strong>层面对关键点坐标进一步精确化。</p>
<blockquote>
<p> <strong>什么是亚像素？</strong>我们获取到的图像是由无数个离散的像素组成，每一个像素点只代表其附近的颜色。而在某些精确化计算的场景下，以像素为单位所能达到的图像精度无法满足场景要求，这时我们通过对相邻两个像素进行插值运算，来获得<strong>两个像素之间某个位置的颜色值，该位置便被称为亚像素</strong>。在图像测量中经常会出现亚像素，如测量某个圆的直径为100.12像素，0.12就是亚像素。</p>
</blockquote>
<p>同样我们使用opencv的函数实现<code>cornerSubPix</code>来精确化关键点坐标信息，函数原型如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cv::cornerSubPix</span>	<span class="params">(InputArray 	image,</span></span></span><br><span class="line"><span class="function"><span class="params">						InputOutputArray 	corners,</span></span></span><br><span class="line"><span class="function"><span class="params">						Size 	winSize,</span></span></span><br><span class="line"><span class="function"><span class="params">						Size 	zeroZone,</span></span></span><br><span class="line"><span class="function"><span class="params">						TermCriteria 	criteria </span></span></span><br><span class="line"><span class="function"><span class="params">						)</span>	</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p><strong>InputArray     image:</strong> 输入图像</p>
</li>
<li><p><strong>InputOutputArray     corners：</strong> 类型为<code>vector&lt;Point2f&gt;</code>的关键点集合，包含了关键点的坐标信息，使用亚像素精确化后会对该集合进行刷新</p>
</li>
<li><p><strong>Size     winSize：</strong>填写默认值<code>Size(11, 11)</code>即可</p>
</li>
<li><p><strong>Size     zeroZone：</strong>填写默认值<code> Size(-1, -1)</code>即可</p>
</li>
<li><p><strong>TermCriteria     criteria :</strong> 迭代终止条件。由于<code>cornerSubPix()</code>函数是依靠迭代完成的，所以我们需要人为的设置迭代终止条件。opencv中提供了专门的迭代终止条件类<code>TermCriteria</code>，该类提供了两种类型的迭代终止条件：完成最大迭代次数停止<code>MAX_ITER</code>、满足迭代精度停止<code>EPS</code>。在本问题中，我们希望二者满足其一即可停止迭代，故我们按照如下格式设置迭代终止条件。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">cv::TermCriteria <span class="title">criteria</span><span class="params">(cv::TermCriteria::EPS | cv::TermCriteria::MAX_ITER, <span class="number">30</span>, <span class="number">0.001</span>)</span></span>;</span><br></pre></td></tr></table></figure>
<p>可见迭代达次数到30次或迭代精度达到0.001二者满足其义即可结束迭代。</p>
</li>
</ul>
<h4 id="2-2-3-可选-在图像上绘制关键点"><a href="#2-2-3-可选-在图像上绘制关键点" class="headerlink" title="2.2.3 (可选)在图像上绘制关键点"></a>2.2.3 (可选)在图像上绘制关键点</h4><p>为了更直观的查看关键点在每一张图片上的位置，我们可以将关键点逐个绘制出来。opencv中也提供了相应的函数实现<code>drawChessboardCorners()</code>，函数原型如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cv::drawChessboardCorners</span>	<span class="params">(InputOutputArray 	image,</span></span></span><br><span class="line"><span class="function"><span class="params">								Size 	patternSize,</span></span></span><br><span class="line"><span class="function"><span class="params">								InputArray 	corners,</span></span></span><br><span class="line"><span class="function"><span class="params">								<span class="keyword">bool</span> 	patternWasFound </span></span></span><br><span class="line"><span class="function"><span class="params">							  )</span>	</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>InputOutputArray     image:</strong> 输入/输出图像</li>
<li><strong>Size     patternSize：</strong>标定板的排布样式，同上文，我们使用6*9排布格式的标定板</li>
<li><strong>InputArray     corners：</strong>检测到的关键点集</li>
<li><strong>bool     patternWasFound ：</strong>该处填写<code>findChessboardCorners()</code>函数的布尔返回值，对于检测到全部关键点的图像，函数将会使用连线将关键点进行连接；对于没有检测出全部关键点的图像，函数只会标记处检测出的关键点位置。</li>
</ul>
<p>最终绘图效果如下图所示，可以看出我们已经检测出了全部关键点并使用彩虹色将他们依次进行了连接。</p>
<img src="https://blogpicbed.oss-cn-beijing.aliyuncs.com/img/FotoJet.jpg" alt="image-20201223230933744" style="zoom:45%;" />

<h3 id="2-3-标定摄像头内外参"><a href="#2-3-标定摄像头内外参" class="headerlink" title="2.3 标定摄像头内外参"></a>2.3 标定摄像头内外参</h3><p>通过上述操作，我们已经获得了关键点在真实世界的三维坐标以及在图像平面上的二维坐标信息，我们将二者作为输入，调用opencv中的<code>calibrateCamera()</code>函数实现即可计算出摄像头的内外参数。<code>calibrateCamera()</code>的函数原型如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">cv::calibrateCamera</span>	<span class="params">(InputArrayOfArrays objectPoints,</span></span></span><br><span class="line"><span class="function"><span class="params">							InputArrayOfArrays 	imagePoints,</span></span></span><br><span class="line"><span class="function"><span class="params">							Size 	imageSize,</span></span></span><br><span class="line"><span class="function"><span class="params">							InputOutputArray 	cameraMatrix,</span></span></span><br><span class="line"><span class="function"><span class="params">							InputOutputArray 	distCoeffs,</span></span></span><br><span class="line"><span class="function"><span class="params">							OutputArrayOfArrays 	rvecs,</span></span></span><br><span class="line"><span class="function"><span class="params">							OutputArrayOfArrays 	tvecs,</span></span></span><br><span class="line"><span class="function"><span class="params">						   )</span>	</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>InputArrayOfArrays objectPoints:</strong> 关键点在真实世界中的三维坐标集合</li>
<li><strong>InputArrayOfArrays     imagePoints：</strong>关键点在图像平面上的二维坐标集合</li>
<li><strong>Size     imageSize</strong>：图像尺寸信息</li>
<li><strong>InputOutputArray     cameraMatrix</strong>：输出摄像机内参矩阵</li>
<li><strong>InputOutputArray     distCoeffs:</strong>  输出镜头畸变系数向量</li>
<li><strong>OutputArrayOfArrays     rvecs：</strong>相机旋转矩阵，外参之一</li>
<li><strong>OutputArrayOfArrays     tvecs：</strong>相机偏移矩阵，外参之一</li>
</ul>
<p>调用上述函数将会计算出相机的内外参数，计算时长取决于标定数据集中的图像数量，最终我们得到了相机的内外参数如下图所示：</p>
<p><img src="https://blogpicbed.oss-cn-beijing.aliyuncs.com/img/image-20201223213014521.png" alt="image-20201223232837530"></p>
<p>我们注意到相机外参矩阵维数很大，这是由于每一张图片中相机与标定板之间的相对位置不同，故代表两者位置关系的相机外参也不同，每一张图片的外参都会单独计算。而在相机畸变矫正中我们不需要使用到相机与目标之间的位置关系，故我们只是用相机内参对图像进行矫正即可，即我们仅关注<code>cameraMatrix</code>与<code>distCoeffs</code>两个变量。</p>
<h3 id="2-4-畸变矫正"><a href="#2-4-畸变矫正" class="headerlink" title="2.4 畸变矫正"></a>2.4 畸变矫正</h3><p>对图像的畸变进行矫正有两种实现，两种实现的输入均相同，下面分别对两种方法进行介绍。</p>
<h4 id="2-4-1-使用initUndistortRectifyMap-remap-实现"><a href="#2-4-1-使用initUndistortRectifyMap-remap-实现" class="headerlink" title="2.4.1  使用initUndistortRectifyMap()+remap()实现"></a>2.4.1  使用<code>initUndistortRectifyMap()</code>+<code>remap()</code>实现</h4><p>该方法的代码如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cv::initUndistortRectifyMap(cameraMatrix, distCoeffs, cv::Mat(),</span><br><span class="line">                            cv::getOptimalNewCameraMatrix(cameraMatrix, </span><br><span class="line">                                                          distCoeffs,   </span><br><span class="line">                                                          imageSize, <span class="number">1</span>, </span><br><span class="line">                                                          imageSize,<span class="number">0</span>),</span><br><span class="line">                            imageSize, CV_16SC2, map1, map2);</span><br><span class="line">cv::remap(frame, dst, map1, map2, cv::INTER_LINEAR);</span><br></pre></td></tr></table></figure>
<p>该部分代码只做功能性的介绍：<code>cameraMatrix</code>与 <code>distCoeffs</code>代表相机内参，<code>imageSize</code>代表图像尺寸，通过<code>cv::getOptimalNewCameraMatrix</code>函数来选择矫正后的图像是否保留畸变矫正所产生的黑色边缘，<code>map1</code>与<code>map2</code>则代表了<code>remap()</code>函数所需要的畸变坐标映射矩阵，作为<code>remap()</code>函数的输入。</p>
<p>下图展示了是否保留黑色边缘对图像的影响，左图是保留黑边的效果图，右图则是剔除黑边后的图像。可以观察到如果保留黑边则原始图像的全部像素信息都会被保留，但是图像边缘会包含黑色的无用像素区域。而右图所示的剔除黑边效果图实际上只是在左图的基础上按照原始图像的比例对非黑色区域进行了裁剪，虽然去除了黑边，但是会损失位于角落的像素信息。</p>
<p><img src="https://blogpicbed.oss-cn-beijing.aliyuncs.com/img/image-20201223230933744.png" alt="black_edge"></p>
<h4 id="2-4-2-使用cv-undistort-实现"><a href="#2-4-2-使用cv-undistort-实现" class="headerlink" title="2.4.2  使用cv::undistort()实现"></a>2.4.2  使用<code>cv::undistort()</code>实现</h4><p>该方法实现代码如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cv::new_camera_matrix;</span><br><span class="line">new_camera_matrix = cv::getOptimalNewCameraMatrix(cameraMatrix, distCoeffs, imageSize, <span class="number">1</span>, imageSize, <span class="number">0</span>);</span><br><span class="line">cv::undistort( frame, dst, new_camera_matrix, distCoeffs, new_camera_matrix );</span><br></pre></td></tr></table></figure>
<p>本质上是 <code>initUndistortRectifyMap()</code>与<code>remap()</code>两个函数的封装，最终的矫正效果是相同的。但是从效率层面上讲，由于<code>remap()</code>函数需要调用 <code>initUndistortRectifyMap()</code>函数计算得到的两个参量<code>map1</code>与<code>map2</code>，对同一镜头拍摄的多张畸变图像进行矫正时，畸变坐标映射矩阵<code>map1</code>与<code>map2</code>计算一次即可，此时若使用<code>cv::undistort()</code>进行畸变矫正则会反复计算<code>map1</code>与<code>map2</code>，影响程序效率。因此当需要矫正的畸变图像很多时，调用一次<code>initUndistortRectifyMap()</code>统一计算出畸变坐标映射矩阵<code>map1</code>与<code>map2</code>，然后反复调用<code>remap()</code>函数进行畸变矫正即可。</p>
<h4 id="2-4-3-畸变矫正效果展示"><a href="#2-4-3-畸变矫正效果展示" class="headerlink" title="2.4.3 畸变矫正效果展示"></a>2.4.3 畸变矫正效果展示</h4><p>对于数据集中的一张图像进行畸变矫正，总体效果如下</p>
<p><img src="https://blogpicbed.oss-cn-beijing.aliyuncs.com/img/image-20201223144024650.png" alt="FotoJet"></p>
<p><strong>输入的原始图像</strong></p>
<p><img src="C:\Users\杨济宁\Pictures\1.jpg" alt="1"></p>
<p><strong>保留黑色边缘的矫正图像</strong></p>
<p><img src="C:\Users\杨济宁\Pictures\with_edge.jpg" alt="with_edge"></p>
<p><strong>剔除黑色边缘后的矫正图像</strong></p>
<p><img src="C:\Users\杨济宁\Pictures\no_edge.jpg" alt="no_edge"></p>
<h2 id="三、程序代码"><a href="#三、程序代码" class="headerlink" title="三、程序代码"></a>三、程序代码</h2><h3 id="图像采集代码"><a href="#图像采集代码" class="headerlink" title="图像采集代码"></a>图像采集代码</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;opencv2/highgui/highgui.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;	</span><br><span class="line">	<span class="function">VideoCapture <span class="title">cap</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">	<span class="keyword">if</span> (!cap.isOpened())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;摄像头读取错误!&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//获取视频尺寸</span></span><br><span class="line">	<span class="keyword">char</span> filename[<span class="number">200</span>];</span><br><span class="line">	cap.<span class="built_in">set</span>(CAP_PROP_FRAME_WIDTH, <span class="number">2560</span>); </span><br><span class="line">	cap.<span class="built_in">set</span>(CAP_PROP_FRAME_HEIGHT,<span class="number">720</span>);</span><br><span class="line">	<span class="keyword">int</span> i =<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">string</span> name;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;拍照模式：按空格键进行拍摄。q 或 Esc 退出。&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="built_in">string</span> window_name = <span class="string">&quot;video | q or esc to quit&quot;</span>;</span><br><span class="line">	namedWindow(window_name,WINDOW_NORMAL); <span class="comment">//not resizable window;</span></span><br><span class="line">	Mat frameTotal;</span><br><span class="line">	<span class="comment">//Rect Total(0, 150, 640, 180);//全画幅</span></span><br><span class="line">	<span class="function">Rect <span class="title">Lrect</span><span class="params">(<span class="number">0</span>,<span class="number">0</span>, <span class="number">2560</span>/<span class="number">2</span>,<span class="number">720</span>)</span></span>;<span class="comment">//左ROI</span></span><br><span class="line">	<span class="function">Rect <span class="title">Rrect</span><span class="params">(<span class="number">2560</span> / <span class="number">2</span>, <span class="number">0</span>, <span class="number">2560</span>/<span class="number">2</span>, <span class="number">720</span>)</span></span>; <span class="comment">//右ROI</span></span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		cap &gt;&gt; frameTotal;</span><br><span class="line">		imshow(<span class="string">&quot;video | q or esc to quit&quot;</span>, frameTotal);</span><br><span class="line">		<span class="keyword">char</span> key = (<span class="keyword">char</span>)waitKey(<span class="number">30</span>);</span><br><span class="line">		<span class="keyword">switch</span> (key)</span><br><span class="line">		&#123;</span><br><span class="line">		<span class="keyword">case</span><span class="number">&#x27;</span>q<span class="number">&#x27;</span>:</span><br><span class="line">		<span class="keyword">case</span><span class="number">&#x27;</span>Q<span class="number">&#x27;</span>:</span><br><span class="line">		<span class="keyword">case</span> <span class="number">27</span>:</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&#x27; &#x27;</span>:</span><br><span class="line">			sprintf_s(filename, <span class="string">&quot;Capture_%d.jpg&quot;</span>, i);</span><br><span class="line">			imwrite(filename, frameTotal);<span class="comment">//保存全画幅</span></span><br><span class="line">			sprintf_s(filename, <span class="string">&quot;L_%d.jpg&quot;</span>, i);</span><br><span class="line">			imwrite(filename, frameTotal(Lrect));<span class="comment">//保存左画幅</span></span><br><span class="line">			sprintf_s(filename, <span class="string">&quot;R_%d.jpg&quot;</span>, i);</span><br><span class="line">			imwrite(filename, frameTotal(Rrect));<span class="comment">//保存右画幅</span></span><br><span class="line">			<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;捕捉到第&quot;</span>&lt;&lt;i&lt;&lt;<span class="string">&quot;组图像&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">			i++;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="相机标定代码"><a href="#相机标定代码" class="headerlink" title="相机标定代码"></a>相机标定代码</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/calib3d/calib3d.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/highgui/highgui.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/imgproc/imgproc.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义标定板内角点维数</span></span><br><span class="line"><span class="keyword">int</span> CHESSBOARD[<span class="number">2</span>] = &#123; <span class="number">6</span>,<span class="number">9</span> &#125;;<span class="comment">//纵向6个角点，横向9个角点</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">//////// 标定数据集的导入 //////////</span></span><br><span class="line">	<span class="built_in">vector</span>&lt;String&gt; image_paths;<span class="comment">//数据集中图像的路径</span></span><br><span class="line">	<span class="built_in">string</span> path = <span class="string">&quot;.\\data_set40\\Right&quot;</span>;<span class="comment">//图像名称格式</span></span><br><span class="line">	glob(path,image_paths);<span class="comment">// 将所有符合格式的图像路径存储到image_paths中</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">////// 世界坐标系三维坐标输入 //////</span></span><br><span class="line">	<span class="built_in">vector</span>&lt;Point3f&gt;objp; <span class="comment">// 存储关键点在真实世界中的三维坐标</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; CHESSBOARD[<span class="number">1</span>]; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; CHESSBOARD[<span class="number">0</span>]; j++)</span><br><span class="line">			objp.push_back(Point3f(i, j, <span class="number">0</span>));<span class="comment">//逐行标记内角点坐标</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	Mat src,img;<span class="comment">//图像</span></span><br><span class="line">	<span class="built_in">vector</span>&lt;Point2f&gt; corners;</span><br><span class="line">	<span class="keyword">bool</span> found;</span><br><span class="line">	<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;Point3f&gt;&gt; objPoints;<span class="comment">//为整个数据集创建其在真实世界的三维坐标集合。</span></span><br><span class="line">	<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;Point2f&gt;&gt; imgPoints;<span class="comment">//图像上的关键点坐标位置</span></span><br><span class="line">	<span class="comment">///////// 遍历数据集 &amp;&amp; 确定关键点位置 ///////////</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; image_paths.size(); i++)</span><br><span class="line">	&#123;</span><br><span class="line">		src = imread(image_paths[i]);</span><br><span class="line">		cvtColor(src, img, COLOR_BGR2GRAY);</span><br><span class="line">		<span class="comment">//寻找关键点位置</span></span><br><span class="line">		found = findChessboardCorners(img, </span><br><span class="line">									Size(CHESSBOARD[<span class="number">0</span>], CHESSBOARD[<span class="number">1</span>]),corners, </span><br><span class="line">									CALIB_CB_ADAPTIVE_THRESH + CALIB_CB_NORMALIZE_IMAGE + CALIB_CB_FAST_CHECK);</span><br><span class="line">		<span class="keyword">if</span> (found)<span class="comment">//在图像上确定出内角点信息</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="function">TermCriteria <span class="title">criteria</span><span class="params">(CV_TERMCRIT_EPS | CV_TERMCRIT_ITER, <span class="number">30</span>, <span class="number">0.001</span>)</span></span>;<span class="comment">//设置最大迭代次数与迭代终止条件</span></span><br><span class="line">			<span class="comment">//使用亚像素精准化关键点坐标位置</span></span><br><span class="line">			cornerSubPix(img, corners, cv::Size(<span class="number">11</span>, <span class="number">11</span>), cv::Size(<span class="number">-1</span>, <span class="number">-1</span>), criteria);</span><br><span class="line">			<span class="comment">//在图像上显示检测到的关键点</span></span><br><span class="line">			drawChessboardCorners(src, cv::Size(<span class="number">6</span>, <span class="number">9</span>), corners, found);</span><br><span class="line"></span><br><span class="line">			objPoints.push_back(objp);</span><br><span class="line">			imgPoints.push_back(corners);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//namedWindow(&quot;Corner Detected&quot;, WINDOW_KEEPRATIO);</span></span><br><span class="line">		cv::imshow(<span class="string">&quot;Corner Detected&quot;</span>, src);<span class="comment">//展示图像</span></span><br><span class="line">		waitKey(<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	cv::destroyAllWindows();</span><br><span class="line">	<span class="comment">////////// 计算相机内外参数 ///////////</span></span><br><span class="line">	cv::Mat cameraMatrix, distCoeffs, R, T;</span><br><span class="line">	cv::calibrateCamera(objPoints, imgPoints, cv::Size(img.rows,img.cols), cameraMatrix, distCoeffs, R, T);</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;cameraMatrix : &quot;</span> &lt;&lt; cameraMatrix &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;distCoeffs : &quot;</span> &lt;&lt; distCoeffs &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Rotation vector : &quot;</span> &lt;&lt; R &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Translation vector : &quot;</span> &lt;&lt; T &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="畸变矫正代码"><a href="#畸变矫正代码" class="headerlink" title="畸变矫正代码"></a>畸变矫正代码</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;opencv2/highgui/highgui.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	cv::Mat image;</span><br><span class="line">	image = cv::imread(<span class="string">&quot;1.jpg&quot;</span>);</span><br><span class="line">	cv::Mat cameraMatrix, distCoeffs;</span><br><span class="line">	cv::Mat dst, map1, map2, new_camera_matrix;</span><br><span class="line">	<span class="function">cv::Size <span class="title">imageSize</span><span class="params">(cv::Size(image.cols, image.rows))</span></span>;</span><br><span class="line">	<span class="comment">//对左摄像头采集到的图像进行矫正</span></span><br><span class="line">    <span class="comment">//镜头内参输入</span></span><br><span class="line">	cameraMatrix = (Mat_&lt;<span class="keyword">float</span>&gt;(<span class="number">3</span>,<span class="number">3</span>)&lt;&lt; <span class="number">1363.068832071628</span>, <span class="number">0</span>, <span class="number">597.5310820482522</span>,<span class="number">0</span>, <span class="number">1364.502172300807</span>, <span class="number">380.6142772218984</span>,<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>);<span class="comment">//相机内参矩阵</span></span><br><span class="line">	distCoeffs = (Mat_&lt;<span class="keyword">float</span>&gt;(<span class="number">1</span>, <span class="number">5</span>) &lt;&lt; <span class="number">-0.4401953292696111</span>, <span class="number">0.1678238673295687</span>, <span class="number">4.136661811836659e-05</span>, <span class="number">0.001406248426772503</span>, <span class="number">0.1224192370990156</span>);<span class="comment">//相机畸变向量</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//计算畸变映射矩阵</span></span><br><span class="line">	cv::initUndistortRectifyMap(cameraMatrix, distCoeffs, cv::Mat(), cv::getOptimalNewCameraMatrix(cameraMatrix, distCoeffs, imageSize, <span class="number">0</span>, imageSize, <span class="number">0</span>), imageSize, CV_16SC2, map1, map2);</span><br><span class="line">	<span class="comment">//畸变矫正</span></span><br><span class="line">	cv::remap(image, dst, map1, map2, cv::INTER_LINEAR);</span><br><span class="line">	imshow(<span class="string">&quot;Distorted img&quot;</span>, dst);</span><br><span class="line">	cvWaitKey(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="四、参考资料"><a href="#四、参考资料" class="headerlink" title="四、参考资料"></a>四、参考资料</h2><p>主要参考以下博文：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.learnopencv.com/camera-calibration-using-opencv/">Camera Calibration using OpenCV</a></li>
<li><a target="_blank" rel="noopener" href="https://www.learnopencv.com/geometry-of-image-formation/">Geometry of Image Formation</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/datase/article/details/77587357">张正友法标定流程</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/u013289254/article/details/99200881">vs2015 + opencv3 双目摄像头标定（C++实现）</a></li>
<li><a target="_blank" rel="noopener" href="https://jingyan.baidu.com/article/63f2362826ea1c0208ab3dec.html">相机标定之四个坐标系及其关系</a></li>
<li><a target="_blank" rel="noopener" href="https://www.pomeas.cn/newsview/529.html">什么是亚像素？</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/riddick/p/6711263.html">OpenCV畸变校正原理以及损失有效像素原理分析</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/66863619">Opencv中的两种去畸变函数</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/yghjkliikk/article/details/110070315">cv2.getOptimalNewCameraMatrix中的alpha和roi参数</a></li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/12/29/hello-world/" rel="prev" title="Hello World">
                  <i class="fa fa-chevron-left"></i> Hello World
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>







<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">杨济宁</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
